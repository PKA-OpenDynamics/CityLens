services:
  # Backend API
  - type: web
    name: citylens-backend
    runtime: docker
    dockerfilePath: ./backend/Dockerfile.production
    dockerContext: ./backend
    plan: free
    branch: khoadev_features
    envVars:
      - key: PROJECT_NAME
        value: CityLens
      - key: VERSION
        value: 0.3.0
      - key: API_V1_STR
        value: /api/v1
      - key: LOG_LEVEL
        value: INFO
      
      # Security - CHANGE SECRET_KEY!
      - key: SECRET_KEY
        generateValue: true
      - key: ALGORITHM
        value: HS256
      - key: ACCESS_TOKEN_EXPIRE_MINUTES
        value: 11520
      
      # CORS
      - key: BACKEND_CORS_ORIGINS
        value: '["*"]'
      
      # PostgreSQL (auto-linked from database below)
      - key: POSTGRES_SERVER
        fromDatabase:
          name: citylens-db
          property: host
      - key: POSTGRES_PORT
        fromDatabase:
          name: citylens-db
          property: port
      - key: POSTGRES_DB
        fromDatabase:
          name: citylens-db
          property: database
      - key: POSTGRES_USER
        fromDatabase:
          name: citylens-db
          property: user
      - key: POSTGRES_PASSWORD
        fromDatabase:
          name: citylens-db
          property: password
      
      # MongoDB Atlas (ADD YOUR CONNECTION STRING)
      - key: MONGODB_URL
        value: mongodb+srv://Khoa09102004:citylens2025@cluster0.xxxxx.mongodb.net/citylens_realtime?retryWrites=true&w=majority
      - key: MONGODB_DB
        value: citylens_realtime
      
      # Redis (Optional - disable for now)
      - key: REDIS_HOST
        value: ""
      - key: REDIS_PORT
        value: 6379
      
      # GraphDB (Disable for MVP)
      - key: GRAPHDB_URL
        value: ""
      - key: GRAPHDB_REPOSITORY
        value: citylens
      
      # Media Storage
      - key: MEDIA_STORAGE
        value: local
      - key: UPLOAD_DIR
        value: /app/uploads
      
      # External APIs (Optional)
      - key: OPENWEATHER_API_KEY
        value: ""
      - key: TOMTOM_API_KEY
        value: ""
      - key: AQICN_API_KEY
        value: ""
    
    healthCheckPath: /
    
    buildCommand: echo "Building with Docker..."
    
databases:
  # PostgreSQL Database
  - name: citylens-db
    databaseName: citylens_db
    user: citylens_user
    plan: free
    ipAllowList: []
